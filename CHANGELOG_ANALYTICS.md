# Changelog: –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ—Å—Ç–æ–≤

## –í–µ—Ä—Å–∏—è: Analytics v1.0

**–î–∞—Ç–∞:** 20 —è–Ω–≤–∞—Ä—è 2026

### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

#### üìä –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫
- –°–±–æ—Ä –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, —Ä–µ–∞–∫—Ü–∏–π –∏ –ø–µ—Ä–µ—Å—ã–ª–æ–∫ –∏–∑ Telegram
- –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ (engagement rate)
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–Ω–∏–º–∫–∏ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏–∫–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–π –ø–æ —ç–º–æ–¥–∑–∏

#### ü§ñ –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/analytics [–¥–Ω–µ–π]` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
- `/update_stats` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ Telegram
- `/top [–∫—Ä–∏—Ç–µ—Ä–∏–π] [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ] [–¥–Ω–µ–π]` - —Ç–æ–ø –ø–æ—Å—Ç–æ–≤ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º

#### üìà –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ—Å—Ç—ã, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, —Ä–µ–∞–∫—Ü–∏–∏, –ø–µ—Ä–µ—Å—ã–ª–∫–∏)
- –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –ø–æ—Å—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –¢–æ–ø-5 –ø–æ—Å—Ç–æ–≤ –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏

#### ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–Ω–∏–º–∫–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `content_manager_bot/database/models.py`
- –†–∞—Å—à–∏—Ä–µ–Ω–∞ –º–æ–¥–µ–ª—å `Post`:
  - `forwards_count: int` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å—ã–ª–æ–∫
  - `reactions_breakdown: dict` - —Ä–∞–∑–±–∏–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–π {"üëç": 10, "‚ù§Ô∏è": 5}
  - `engagement_rate: float` - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ (%)
  - `last_metrics_update: datetime` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - –ú–µ—Ç–æ–¥—ã: `calculate_engagement_rate()`, `update_engagement_rate()`

- –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `PostAnalytics`:
  - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–Ω–∏–º–∫–∏ –º–µ—Ç—Ä–∏–∫
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏—Ä–æ—Å—Ç–∞ (views_delta, reactions_delta)

#### –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏
**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `content_manager_bot/analytics/`

1. `stats_collector.py` - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ Telegram
   - `StatsCollector.collect_post_stats()` - —Å–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å—Ç–∞
   - `StatsCollector.update_post_metrics()` - –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
   - `StatsCollector.update_all_published_posts()` - –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã
   - `StatsCollector.get_post_growth()` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏—Ä–æ—Å—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥

2. `analytics_service.py` - –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
   - `AnalyticsService.get_overall_stats()` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - `AnalyticsService.get_stats_by_type()` - –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - `AnalyticsService.get_top_posts()` - —Ç–æ–ø –ø–æ—Å—Ç–æ–≤
   - `AnalyticsService.get_reactions_distribution()` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π
   - `AnalyticsService.format_dashboard()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
**–§–∞–π–ª:** `content_manager_bot/handlers/admin.py`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `from content_manager_bot.analytics import StatsCollector, AnalyticsService`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/stats` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ `/analytics`
- –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/analytics` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/update_stats` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/top` - —Ç–æ–ø –ø–æ—Å—Ç–æ–≤ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–ø—Ä–∞–≤–∫–∞ `/help` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

#### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
**–§–∞–π–ª:** `content_manager_bot/utils/keyboards.py`
- –ù–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ `analytics_menu()`:
  - –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∑–∞ 7/30 –¥–Ω–µ–π
  - –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–æ–ø –ø–æ—Å—Ç–æ–≤ (–ø—Ä–æ—Å–º–æ—Ç—Ä—ã, —Ä–µ–∞–∫—Ü–∏–∏, –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å)
  - –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
**–§–∞–π–ª:** `content_manager_bot/scheduler/content_scheduler.py`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `from content_manager_bot.analytics import StatsCollector`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `_last_stats_update: Optional[datetime]`
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_scheduler_loop()` - –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_update_stats_if_needed()`
- –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `_update_stats_if_needed()` - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
**–§–∞–π–ª:** `scripts/migrate_analytics.py`

–î–æ–±–∞–≤–ª—è–µ—Ç:
1. –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `content_posts`:
   - `forwards_count INTEGER DEFAULT 0`
   - `reactions_breakdown JSONB`
   - `engagement_rate FLOAT`
   - `last_metrics_update TIMESTAMP`

2. –ù–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `content_post_analytics`:
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–Ω–∏–º–∫–æ–≤
   - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `docs/ANALYTICS.md` - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- `DEPLOY_ANALYTICS.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

### –ú–µ—Ç—Ä–∏–∫–∏

#### Engagement Rate (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏)
```python
engagement_rate = ((reactions + forwards) / views) * 100
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–≤—à–∏—Ö —Å –ø–æ—Å—Ç–æ–º.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ö–æ–º–∞–Ω–¥—ã
```bash
# –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
/analytics          # –∑–∞ 7 –¥–Ω–µ–π
/analytics 30       # –∑–∞ 30 –¥–Ω–µ–π

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/update_stats

# –¢–æ–ø –ø–æ—Å—Ç–æ–≤
/top                        # —Ç–æ–ø-10 –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ 30 –¥–Ω–µ–π
/top views                  # —Ç–æ–ø –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
/top reactions 5 7          # —Ç–æ–ø-5 –ø–æ —Ä–µ–∞–∫—Ü–∏—è–º –∑–∞ 7 –¥–Ω–µ–π
/top engagement 20 90       # —Ç–æ–ø-20 –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ 90 –¥–Ω–µ–π
```

#### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø
```python
from content_manager_bot.analytics import StatsCollector, AnalyticsService

# –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async with AsyncSessionLocal() as session:
    collector = StatsCollector(bot, session)
    await collector.update_all_published_posts()

# –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
async with AsyncSessionLocal() as session:
    analytics = AnalyticsService(session)
    stats = await analytics.get_overall_stats(days=30)
    top = await analytics.get_top_posts(limit=10, sort_by='engagement')
```

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

```
content_manager_bot/
‚îú‚îÄ‚îÄ database/models.py              # –†–∞—Å—à–∏—Ä–µ–Ω—ã –º–æ–¥–µ–ª–∏ Post + PostAnalytics
‚îú‚îÄ‚îÄ handlers/admin.py               # –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã /analytics, /update_stats, /top
‚îú‚îÄ‚îÄ utils/keyboards.py              # –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ analytics_menu()
‚îú‚îÄ‚îÄ scheduler/content_scheduler.py  # –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îî‚îÄ‚îÄ analytics/                      # –ù–æ–≤—ã–π –º–æ–¥—É–ª—å
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ stats_collector.py          # –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ‚îî‚îÄ‚îÄ analytics_service.py        # –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

scripts/
‚îî‚îÄ‚îÄ migrate_analytics.py            # –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

docs/
‚îî‚îÄ‚îÄ ANALYTICS.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

DEPLOY_ANALYTICS.md                 # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–µ–ø–ª–æ—è
CHANGELOG_ANALYTICS.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### –î–µ–ø–ª–æ–π

```bash
# –ù–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ
cd /root/nl-international-ai-bots
git pull
python scripts/migrate_analytics.py
systemctl restart nl-bots
journalctl -u nl-bots -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –í Telegram –±–æ—Ç–µ @nl_content_bot
/help           # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
/update_stats   # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/analytics      # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞—à–±–æ—Ä–¥
/top            # –¢–æ–ø –ø–æ—Å—Ç–æ–≤
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. Views –≤ –≥—Ä—É–ø–ø–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (Telegram API)
2. –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
3. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –º–æ–º–µ–Ω—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### Roadmap

- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ –º–µ—Ç—Ä–∏–∫
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ª—É—á—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ CSV/Excel
- [ ] –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å
